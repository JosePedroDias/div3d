(function(){var $=function(a){return typeof a==="string"?document.querySelector(a):a};var rad90=Math.PI/2;var boxStuff=[[[2,1],[0,-1,0]],[[2,1],[0,1,0]],[[0,2],[-1,0,0]],[[0,2],[1,0,0]],[[0,1],[0,0,0]],[[0,1],[0,1,0]]];var D3D=function(el,mtx){if(!mtx){mtx=mat4.create(1);mat4.identity(mtx)}this.element=el;this.matrix=mtx};D3D.prototype={update:function(){var m=["matrix3d(",mat4.str(this.matrix),")"].join("");this.element.style.WebkitTransform=m;this.element.style.MozTransform=m;this.element.style.oTransform=m;this.element.style.transform=m},resize:function(dims,center){this.size=dims;var cir=[false,false];var i,d,ci;if(!center){center=[.5,.5];cir=[true,true]}else{for(i=0;i<2;++i){ci=center[i];if(typeof ci==="string"&&ci.indexOf("%")!==-1){ci=parseFloat(ci)*.01;cir[i]=true}}}for(i=0;i<2;++i){ci=center[i];d=dims[i];center[i]=Math.round(-d+ci*(cir[i]?d:1))}var el=this.element;var s=el.style;s.width=dims[0]+"px";s.height=dims[1]+"px";s.marginLeft=center[0]+"px";s.marginTop=center[1]+"px"},addClass:function(clsName){this.element.classList.add(clsName)},removeClass:function(clsName){this.element.classList.remove(clsName)},clear:function(){mat4.identity(this.matrix)},translate:function(vec){mat4.translate(this.matrix,this.matrix,vec)},rotate:function(angle,axis){mat4.rotate(this.matrix,this.matrix,angle,axis)},scale:function(s){if(typeof s==="number"){s=[s,s,s]}mat4.scale(this.matrix,this.matrix,s)},lookAt:function(from,to,up){if(!to){to=[0,0,0]}if(!up){up=[0,1,0]}mat4.lookAt(this.matrix,from,to,up)},clone:function(){return mat4.clone(this.matrix)},opacity:function(n){this.element.style.opacity=n},color:function(c){this.element.style.backgroundColor=c},centerText:function(){var s=this.element.style;s.textAlign="center";s.lineHeight=this.size[1]+"px"},billboard:function(pos){mat4.copy(this.matrix,DIV3D.get("origin").matrix);mat4.transpose(this.matrix,this.matrix);this.matrix[12]=pos[0];this.matrix[13]=pos[1];this.matrix[14]=pos[2];this.matrix[3]=0;this.matrix[7]=0;this.matrix[11]=0;this.matrix[15]=1;this.update()},billboardAxisAligned:function(pos,camPos,axisNum){var look=vec3.create();vec3.sub(look,camPos,pos);look[axisNum]=0;vec3.normalize(look,look);var up=vec3.create();up[axisNum]=1;var right=vec3.create();vec3.cross(right,up,look);var m=this.matrix;m[0]=right[0];m[1]=right[1];m[2]=right[2];m[3]=0;m[4]=up[0];m[5]=up[1];m[6]=up[2];m[7]=0;m[8]=look[0];m[9]=look[1];m[10]=look[2];m[11]=0;m[12]=pos[0];m[13]=pos[1];m[14]=pos[2];m[15]=1;this.update()}};DIV3D={_containerDims:[0,0],_lastId:1,_objects:{},_startT:undefined,init:function(){this._startT=(new Date).valueOf();if(!$("container")){var el=document.createElement("div");el.className="container";document.body.appendChild(el)}this.importDiv(".container","ctn");this.createDiv("g0","#ctn");this._onResize();window.addEventListener("resize",function(){DIV3D._onResize()})},time:function(t){if(!t){t=(new Date).valueOf()-this._startT}this._dt=t-(this._t||1/60);this._t=t;return this._dt},get:function(id){return this._objects[id]},createDiv:function(id,parentEl){var el=document.createElement("div");el.className="node";if(!id){id="d"+this._lastId++}el.id=id;parentEl=parentEl?$(parentEl):$("#g0");parentEl.appendChild(el);return this._finishDiv(el,id)},importDiv:function(elOrSelector,id){var el=$(elOrSelector);if(el.id){id=el.id}else{if(!id){id="d"+this._lastId++;++this._lastId}el.id=id}return this._finishDiv(el,id)},createBox:function(opts){var dims,f,g=this.createDiv(opts.id,opts.parentEl);var a,b;g.faces=new Array(6);for(var i=0;i<6;++i){if(opts.skips&&opts.skips.indexOf(i)!==-1){continue}f=this.createDiv(undefined,g.element);a=boxStuff[i][0];b=opts.dimensions;dims=[b[a[0]],b[a[1]]];f.resize(dims);a=[0,0,0];b=~~(i/2);a[b]=opts.dimensions[b]/(i%2?-2:2)*(b===0?-1:1);f.translate(a);if(i<6){f.rotate(rad90*(i===5?2:1),boxStuff[i][1])}if(opts.forEach){opts.forEach(f,i,dims)}f.update();g.faces[i]=f}return g},_finishDiv:function(el,id){var o=new D3D(el);this._objects[id]=o;return o},_onResize:function(){var W=window.innerWidth;var H=window.innerHeight;this._containerDims=[W,H];var o=this.get("g0");o.clear();o.translate([W/2,H/2,0]);o.update()}}})();