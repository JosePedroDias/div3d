(function(){var $=function(a){return typeof a==="string"?document.querySelector(a):a};var rad90=Math.PI/2;var boxStuff=[[[2,1],[0,-1,0]],[[2,1],[0,1,0]],[[0,2],[-1,0,0]],[[0,2],[1,0,0]],[[0,1],[0,0,0]],[[0,1],[0,1,0]]];var D3D=function(el,mtx){if(!mtx){mtx=mat4.create();mat4.identity(mtx)}this.element=el;this.matrix=mtx};D3D.prototype={update:function(){this.element.style.webkitTransform=["matrix3d(",mat4.str(this.matrix),")"].join("")},resize:function(dims,center){this.size=dims;var cir=[false,false];var i,d,ci;if(!center){center=[.5,.5];cir=[true,true]}else{for(i=0;i<2;++i){ci=center[i];if(typeof ci==="string"&&ci.indexOf("%")!==-1){ci=parseFloat(ci)*.01;cir[i]=true}}}for(i=0;i<2;++i){ci=center[i];d=dims[i];center[i]=Math.round(-d+ci*(cir[i]?d:1))}var el=this.element;var s=el.style;s.width=dims[0]+"px";s.height=dims[1]+"px";s.marginLeft=center[0]+"px";s.marginTop=center[1]+"px"},addClass:function(clsName){this.element.classList.add(clsName)},removeClass:function(clsName){this.element.classList.remove(clsName)},clear:function(){mat4.identity(this.matrix)},translate:function(vec){mat4.translate(this.matrix,vec,this.matrix)},rotate:function(angle,axis){mat4.rotate(this.matrix,angle,axis,this.matrix)},scale:function(s){if(typeof s==="number"){s=[s,s,s]}mat4.scale(this.matrix,s,this.matrix)},getCloneMatrix:function(){return mat4.create(this.matrix)},opacity:function(n){this.element.style.opacity=n},color:function(c){this.element.style.backgroundColor=c},centerText:function(){var s=this.element.style;s.textAlign="center";s.lineHeight=this.size[1]+"px"},round:function(){var s=this.element.style;s.borderRadius="50%"}};DIV3D={_containerDims:[0,0],_lastId:1,_objects:{},_startT:undefined,init:function(){this._startT=(new Date).valueOf();if(!$("container")){var el=document.createElement("div");el.className="container";document.body.appendChild(el)}this.importDiv(".container","ctn");this.createDiv("g0","#ctn");this._onResize();window.addEventListener("resize",function(){DIV3D._onResize()})},time:function(t){if(!t){t=(new Date).valueOf()-this._startT}this._dt=t-(this._t||1/60);this._t=t;return this._dt},get:function(id){return this._objects[id]},createDiv:function(id,parentEl){var el=document.createElement("div");el.className="node";if(!id){id="d"+this._lastId++}el.id=id;parentEl=parentEl?$(parentEl):$("#g0");parentEl.appendChild(el);return this._finishDiv(el,id)},importDiv:function(elOrSelector,id){var el=$(elOrSelector);if(el.id){id=el.id}else{if(!id){id="d"+this._lastId++;++this._lastId}el.id=id}return this._finishDiv(el,id)},createBox:function(opts){var dims,f,g=this.createDiv(opts.id,opts.parentEl);var a,b;g.faces=new Array(6);for(var i=0;i<6;++i){if(opts.skips&&opts.skips.indexOf(i)!==-1){continue}f=this.createDiv(undefined,g.element);a=boxStuff[i][0];b=opts.dimensions;dims=[b[a[0]],b[a[1]]];f.resize(dims);a=[0,0,0];b=~~(i/2);a[b]=opts.dimensions[b]/(i%2?-2:2)*(b===0?-1:1);f.translate(a);if(i<6){f.rotate(rad90*(i===5?2:1),boxStuff[i][1])}if(opts.forEach){opts.forEach(f,i,dims)}f.update();g.faces[i]=f}return g},_finishDiv:function(el,id){var o=new D3D(el);this._objects[id]=o;return o},_onResize:function(){var W=window.innerWidth;var H=window.innerHeight;this._containerDims=[W,H];var o=this.get("g0");o.clear();o.translate([W/2,H/2,0]);o.update()}}})();